<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>System Statistics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2rem;
        }
        h2, h3 {
            color: #2c3e50;
        }
        pre {
            background-color: #f4f4f4;
            padding: 1rem;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h2>System Statistics</h2>
    <div id="stats">Connecting to server...</div>

    <h3>Top Searches</h3>
    <pre id="topSearches">Loading...</pre>

    <h3>Barrel Sizes</h3>
    <pre id="barrelSizes">Loading...</pre>

    <h3>Average Response Times</h3>
    <pre id="responseTimes">Loading...</pre>

    <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
    <script>
        const socket = new SockJS('/ws');
        const stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);
            stompClient.send("/statistics", {}, "");  // trigger stats push

            stompClient.subscribe("/topicGloogloo/statistics", function (message) {
                const raw = message.body;
                document.getElementById('stats').innerText = raw;

                // Parse the string and extract sections
                let topSearches = '';
                let barrelSizes = '';
                let responseTimes = '';

                const lines = raw.split('\n');
                lines.forEach(line => {
                    if (line.startsWith("Top 10 Searches:")) {
                        topSearches = line.replace("Top 10 Searches:", "").trim();
                    } else if (line.startsWith("Barrel Index Sizes:")) {
                        barrelSizes = line.replace("Barrel Index Sizes:", "").trim();
                    } else if (line.startsWith("Average Response Times")) {
                        responseTimes = line.replace("Average Response Times (ms):", "").trim();
                    }
                });

                document.getElementById("topSearches").innerText = topSearches;
                document.getElementById("barrelSizes").innerText = barrelSizes;
                document.getElementById("responseTimes").innerText = responseTimes;
            });
        });
    </script>
</body>
</html>
